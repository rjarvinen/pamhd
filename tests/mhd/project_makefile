TESTS_MHD_EXECUTABLES = \
  tests/mhd/reference.exe \
  tests/mhd/mhd2ascii.exe \
  tests/mhd/mhd2gnuplot.exe \
  tests/mhd/mhd2vtk.exe \
  tests/mhd/mhd_extract.exe \
  tests/mhd/test.exe

TESTS_MHD_TESTS = \
  tests/mhd/reference.tst_rusanov \
  tests/mhd/reference.tst_hll_athena \
  tests/mhd/reference.tst_hlld_athena \
  tests/mhd/reference.tst_roe_athena

tests/mhd_executables: $(TESTS_MHD_EXECUTABLES)

tests/mhd_tests: $(TESTS_MHD_TESTS)

tests/mhd_clean_results:
	@printf "CLEAN RESULTS tests/mhd\n" && rm -f \
	  tests/mhd/*.dat \
	  tests/mhd/*.png \
	  tests/mhd/profile*.txt

tests/mhd_clean:
	@printf "CLEAN tests/mhd\n" && rm -f \
	  $(TESTS_MHD_EXECUTABLES) \
	  $(TESTS_MHD_TESTS)

EXECUTABLES += tests/mhd_executables
TESTS += tests/mhd_tests
RESULTS += tests/mhd_clean_results
CLEAN += tests/mhd_clean


TEST_MHD_COMMON_DEPS = \
  source/mhd/common.hpp \
  source/mhd/variables.hpp \
  source/mhd/hll_athena.hpp \
  source/mhd/hlld_athena.hpp \
  source/mhd/roe_athena.hpp \
  source/mhd/rusanov.hpp \
  tests/mhd/project_makefile \
  $(ENVIRONMENT_MAKEFILE) \
  Makefile

TEST_MHD_PROGRAM_DEPS = \
  $(TEST_MHD_COMMON_DEPS) \
  source/grid_options.hpp \
  source/boundaries/boundaries.hpp \
  source/boundaries/box.hpp \
  source/boundaries/common.hpp \
  source/boundaries/copy_boundaries.hpp \
  source/boundaries/geometries.hpp \
  source/boundaries/initial_condition.hpp \
  source/boundaries/initial_conditions.hpp \
  source/boundaries/multivariable_boundaries.hpp \
  source/boundaries/sphere.hpp \
  source/boundaries/value_boundaries.hpp \
  source/boundaries/value_boundary.hpp \
  source/mhd/background_magnetic_field.hpp \
  source/mhd/boundaries.hpp \
  source/mhd/initialize.hpp \
  source/mhd/options.hpp \
  source/mhd/save.hpp \
  source/mhd/solve.hpp

TEST_MHD_COMPILE_COMMOM = \
  $< -o $@ \
  $(CPPFLAGS) \
  $(CXXFLAGS) \
  $(LDFLAGS) \
  $(BOOST_CPPFLAGS) \
  $(BOOST_LDFLAGS) \
  $(BOOST_LIBS) \
  $(EIGEN_CPPFLAGS) \
  $(GENSIMCELL_CPPFLAGS)

tests/mhd/reference.exe: \
  tests/mhd/reference.cpp \
  $(TEST_MHD_COMMON_DEPS)
	@printf "CXX $<\n" && $(CXX) $(TEST_MHD_COMPILE_COMMOM)

tests/mhd/mhd2ascii.exe: \
  tests/mhd/mhd2ascii.cpp \
  $(TEST_MHD_COMMON_DEPS)
	@printf "MPICXX $<\n" && $(MPICXX) $(TEST_MHD_COMPILE_COMMOM) \
	  $(DCCRG_CPPFLAGS) \
	  $(ZOLTAN_CPPFLAGS) \
	  $(ZOLTAN_LDFLAGS) \
	  $(ZOLTAN_LIBS)

tests/mhd/mhd2gnuplot.exe: \
  tests/mhd/mhd2gnuplot.cpp \
  $(TEST_MHD_COMMON_DEPS)
	@printf "MPICXX $<\n" && $(MPICXX) $(TEST_MHD_COMPILE_COMMOM) \
	  $(DCCRG_CPPFLAGS) \
	  $(PRETTYPRINT_CPPFLAGS) \
	  $(ZOLTAN_CPPFLAGS) \
	  $(ZOLTAN_LDFLAGS) \
	  $(ZOLTAN_LIBS)

tests/mhd/mhd2vtk.exe: \
  tests/mhd/mhd2vtk.cpp \
  $(TEST_MHD_COMMON_DEPS)
	@printf "MPICXX $<\n" && $(MPICXX) $(TEST_MHD_COMPILE_COMMOM) \
	  $(DCCRG_CPPFLAGS) \
	  $(ZOLTAN_CPPFLAGS) \
	  $(ZOLTAN_LDFLAGS) \
	  $(ZOLTAN_LIBS)

tests/mhd/mhd_extract.exe: \
  tests/mhd/mhd_extract.cpp \
  tests/mhd/project_makefile \
  $(ENVIRONMENT_MAKEFILE) \
  Makefile
	@printf "CXX $<\n" && $(CXX) $(TEST_MHD_COMPILE_COMMOM)

tests/mhd/test.exe: \
  tests/mhd/test.cpp \
  $(TEST_MHD_PROGRAM_DEPS)
	@printf "MPICXX $<\n" && $(MPICXX) $(TEST_MHD_COMPILE_COMMOM) \
	  $(DCCRG_CPPFLAGS) \
	  $(MUPARSERX_CPPFLAGS) \
	  $(MUPARSERX_LDFLAGS) \
	  $(MUPARSERX_LIBS) \
	  $(PHIPROF_CPPFLAGS) \
	  $(PRETTYPRINT_CPPFLAGS) \
	  $(RAPIDJSON_CPPFLAGS) \
	  $(ZOLTAN_CPPFLAGS) \
	  $(ZOLTAN_LDFLAGS) \
	  $(ZOLTAN_LIBS)

tests/mhd/reference.tst_rusanov: tests/mhd/reference.exe
	@printf RUN\ Rusanov\ $<...\ \  && $(RUN) ./$< --solver rusanov && printf "PASS\n" && touch $@
tests/mhd/reference.tst_hll_athena: tests/mhd/reference.exe
	@printf RUN\ HLL_Athena\ $<...\ \  && $(RUN) ./$< --solver hll_athena && printf "PASS\n" && touch $@
tests/mhd/reference.tst_hlld_athena: tests/mhd/reference.exe
	@printf RUN\ HLLD_Athena\ $<...\ \  && $(RUN) ./$< --solver hlld_athena && printf "PASS\n" && touch $@
tests/mhd/reference.tst_roe_athena: tests/mhd/reference.exe
	@printf RUN\ Roe_Athena\ $<...\ \  && $(RUN) ./$< --solver roe_athena && printf "PASS\n" && touch $@
